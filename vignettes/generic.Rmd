---
title: "Generic Derivations"
output:
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Generic Derivations}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(admiraldev)
```

# Introduction

# Characterization of Derivations

- What should be added? There are two options:
    - _Variables_
    - _Records_
- What is the source data? There are two options:
    - A _single_ source dataset
    - _Multiple_ source datasets
- Which method should be used? There are three options:
    - _Selection_: The new values are derived by selecting records, e.g., the
    baseline records, the last exposure record, ...
    - _Summary_: The new values are derived by summarizing values, e.g.., sum,
    average, concatenation, ...
    - _Computation_: The new values are derived by a computation with more than
    one value as input, e.g., deriving BMI or BSA from height and weight 

## Overview of Derivations

```{r, echo=FALSE}
library(reactable)

generic_derivations <- tibble::tribble(
  ~Derivation,                      ~Method,       ~What,       ~Source,
  "derive_var_extreme_flag()",      "selection",   "variables", "single",
  "derive_var_joined_exist_flag()", "selection",   "variables", "single",
  "derive_var_merged_exist_flag()", "selection",   "variables", "single",
  "derive_vars_merged_summary()",   "summary",     "variables", "single",
  "derive_vars_joined()",           "selection",   "variables", "single",
  "derive_vars_merged()",           "selection",   "variables", "single",
  "derive_extreme_event()",         "selection",   "records",   "multiple",
  "derive_extreme_records()",       "selection",   "records",   "single",
  "derive_param_computed()",        "computation", "records",   "single",
  "derive_param_exist_flag()",      "selection",   "records",   "single",
  "derive_summary_records()",       "summary",     "records",   "single"
)

reactable(
  generic_derivations,
  defaultSorted = c("Method", "What", "Source"),
  filterable = TRUE,
  resizable = TRUE,
  defaultPageSize = 20
)
```

# Source Data

## Single Source Dataset

The data is provided by the `dataset_add` argument. This is a mandatory argument. The data provided by the dataset argument is not used. (Add exceptions) 

## Multiple Source Datasets

The data is provided by the `source_datasets` argument. The datasets are referred to by the `dataset_name` element of the source objects. If the  dataset_name element is not specified, the input dataset is used. (Not fulfilled by all functions.) (Add example)

# Methods

## Selection


### Options for Selection

- condition: `filter_add`, `filter`
- first or last records: `order`, `mode`
- other records: `filter_join`, `join_vars`, `join_type`, `first_cond_upper`, `first_cond_lower`

### New Values

- flag: `new_var`/`exist_flat`, `true_value`, `false_value`, `missing_value`
- variables from the selected records: `new_vars`, `set_values_to`

## Summary

Summary functions in `new_vars`/`set_values_to`

## Computed

`parameters`, `new_vars`, `set_values_to`
